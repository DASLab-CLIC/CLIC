apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: compute-scheduling-flow
spec:
  entrypoint: my-flow
  volumes:
  - name: job-volume
    hostPath:
      path: /home/dqh/codes/k8s_basics/executable-java/data
      type: Directory
  templates:
  - name: my-flow
    dag:
      tasks:
      - name: Job-java-SourceFilter660-1
        template: java-template
        arguments:
          parameters:
          - name: javaArgs
            value: 'java -jar executable-java.jar --udfPath=/data/TestSmallWebCaseFunc.class
              --operator=SourceOperator --input=data/test.csv --separator=, --operator=FilterOperator
              --udfName=filterFunc --operator=SinkOperator --output=data/1.csv --separator=, '
      - name: Job-spark-Map878-2
        template: spark-template
        arguments:
          parameters:
          - name: sparkArgs
            value: 'spark submit executable-spark.jar --udfPath=/data/TestSmallWebCaseFuncSpark.class
              --operator=SourceOperator --input=data/1.csv --separator=, --operator=MapOperator
              --udfName=mapFunc --operator=SinkOperator --output=data/2.csv --separator=, '
        dependencies:
        - Job-java-SourceFilter660-1
      - name: Job-java-ReduceByKeySortSink803-3
        template: java-template
        arguments:
          parameters:
          - name: javaArgs
            value: 'java -jar executable-java.jar --udfPath=/data/TestSmallWebCaseFunc.class
              --operator=SourceOperator --input=data/2.csv --separator=, --operator=ReduceByKeyOperator
              --keyName=reduceKey --udfName=reduceFunc --operator=SortOperator --udfName=sortFunc
              --operator=SinkOperator --output=data/output.csv --separator=, '
        dependencies:
        - Job-spark-Map878-2
  - name: java-template
    inputs:
      parameters:
      - name: javaArgs
    container:
      image: executable-java:v1
      imagePullPolicy: IfNotPresent
      command:
      - /bin/sh
      - -c
      args:
      - '{{inputs.parameters.javaArgs}}'
      volumeMounts:
      - mountPath: /data
        name: job-volume
  - name: spark-template
    inputs:
      parameters:
      - name: sparkArgs
    container:
      image: executable-spark:v1
      imagePullPolicy: IfNotPresent
      command:
      - /bin/sh
      - -c
      args:
      - '{{inputs.parameters.sparkArgs}}'
      volumeMounts:
      - mountPath: /data
        name: job-volume
