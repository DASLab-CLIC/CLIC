apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: compute-scheduling-flow
spec:
  entrypoint: my-flow
  volumes:
  - name: job-volume
    hostPath:
      path: /home/dqh/codes/k8s_basics/executable-java/data
      type: Directory
  templates:
  - name: my-flow
    dag:
      tasks:
      - name: Job-java-SoFiMaReSoSi733-1
        template: java-template
        arguments:
          parameters:
          - name: javaArgs
            value: 'java -jar executable-java.jar --udfPath=/data/TestSmallWebCaseFunc.class
              --operator=SourceOperator --input=data/test.csv --separator=, --operator=FilterOperator
              --udfName=filterFunc --operator=MapOperator --udfName=mapFunc --operator=ReduceByKeyOperator
              --keyName=reduceKey --udfName=reduceFunc --operator=SortOperator --udfName=sortFunc
              --operator=SinkOperator --output=data/output.csv --separator=, '
  - name: java-template
    inputs:
      parameters:
      - name: javaArgs
    container:
      image: executable-java:v1
      imagePullPolicy: IfNotPresent
      command:
      - /bin/sh
      - -c
      args:
      - '{{inputs.parameters.javaArgs}}'
      volumeMounts:
      - mountPath: /data
        name: job-volume
